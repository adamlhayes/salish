#install.packages("statnet")
require(statnet)
setwd("C:/Users/alhayes/Desktop/salish/DataGathering/hyperlinks/issuecrawler")
hypIC2Edges <- read.csv("hyperlinksIC2_edgelist.csv", header = FALSE)
ICNodes <- read.csv("icl2_nodes.csv", header = FALSE)
ICNodes <- as.vector(ICNodes[,2])

#re-order ICNodes
vertex_match <- match(network.vertex.names(net), ICNodes, nomatch=999)
ICNodes <- network.vertex.names(net)[vertex_match != 999]


setwd("C:/Users/alhayes/Desktop/salish/Data")


#Previous data

load("NetworkReady.RData")

#Initialize hyperlink network_hyperlink nodes only (n=186)
ic2_temp <- network.initialize(length(ICNodes),
                                   directed=TRUE,loops=FALSE, bipartite = FALSE)
network.vertex.names(ic2_temp) <- ICNodes
TAIL_ID <- match(hypIC2Edges[,1],network.vertex.names(ic2_temp))
HEAD_ID <- match(hypIC2Edges[,2],network.vertex.names(ic2_temp))

for (i in 1:length(TAIL_ID)) {
  ic2_temp[TAIL_ID[i],HEAD_ID[i]]<-1
}

vertex_match <- match(network.vertex.names(net), network.vertex.names(ic2_temp), nomatch=999)

net_hypIC2 <- matrix(nrow = length(network.vertex.names(ic2_temp)), ncol = length(network.vertex.names(ic2_temp)))

missingNode <- c()
for (i in 1:length(vertex_match)){
  if (vertex_match[i] == 999){
    missingNode <- c(missingNode, i)
  }
}

netEdges <- as.matrix(net)
netEdgesIC <- netEdges[-c(missingNode),]
netEdgesIC <- netEdgesIC[,-c(missingNode)]

hirep_orgs <- get.vertex.attribute(net, "ORGTYPE")
levels(as.factor(hirep_orgs))
hirep_orgs[hirep_orgs == "City_Gov"
           | hirep_orgs == "Consulting"
           | hirep_orgs == "Local_Advocacy"
           | hirep_orgs == "Local_Commission"
           | hirep_orgs == "Local_Outreach/Ed"
           | hirep_orgs == "NGO"
           | hirep_orgs == "NR_Industry"
           | hirep_orgs == "Parks_Reserves"
           | hirep_orgs == "Regional_Advocacy"
           | hirep_orgs == "Regional_Commission"
           | hirep_orgs == "Special_District"
           | hirep_orgs == "Tribe"] <- "a"
hirep_orgs_hypIC2 <- hirep_orgs[-c(missingNode)]

net_hypIC2 <- netEdgesIC
OrgType_hypIC2 <- get.vertex.attribute(net, "ORGTYPE")
OrgType_hypIC2 <- OrgType_hypIC2[-c(missingNode)]

set.vertex.attribute(ic2_temp, "OrgType", OrgType_hypIC2)
set.vertex.attribute(ic2_temp, "OrgType_HiRep", hirep_orgs_hypIC2)

hypIC2 <- ic2_temp
net_hypIC2 <- netEdgesIC


setwd("C:/Users/alhayes/Desktop/salish/analysis")
save(hypIC2, file = "hyperlinksICL2.RData")
save(net_hypIC2, file = "netHypIC2.RData")
