#install.packages("statnet")

require(statnet)

setwd("C:/Users/alhayes/Desktop/salish/Data")
#setwd("C:/Users/alhayes/Desktop/salish/analysis")
#Previous data from Tyler
load("NetworkReady.RData")

#Read in twitter edge data
twitterEdgesAll <- read.csv("twitter_edgelist_all.csv", header = FALSE)
twitterEdgesNoRT <- read.csv("twitter_edgelist_noRT.csv", header = FALSE)
twitterNodes <- read.csv("twitter_nodes.csv", header = FALSE)
twitterNodes <- as.vector(twitterNodes[,1])

#re-order TwitterNodes
vertex_match <- match(network.vertex.names(net), twitterNodes, nomatch=999)
twitterNodes <- network.vertex.names(net)[vertex_match != 999]

#Initialize twitter network_twitter nodes only (n=121)
twitter_tempAll <- network.initialize(length(twitterNodes),
                                   directed=TRUE,loops=FALSE, bipartite = FALSE)
network.vertex.names(twitter_tempAll) <- twitterNodes
twitter_tempNoRT <- twitter_tempAll

#Read in twitter_tempAll network links
TAIL_ID <- match(twitterEdgesAll[,1],network.vertex.names(twitter_tempAll))
HEAD_ID <- match(twitterEdgesAll[,2],network.vertex.names(twitter_tempAll))
for (i in 1:length(TAIL_ID)) {
  twitter_tempAll[TAIL_ID[i],HEAD_ID[i]]<-1
}

#Read in twitter_tempNoRT network links
TAIL_ID <- match(twitterEdgesNoRT[,1],network.vertex.names(twitter_tempNoRT))
HEAD_ID <- match(twitterEdgesNoRT[,2],network.vertex.names(twitter_tempNoRT))
for (i in 1:length(TAIL_ID)) {
  twitter_tempNoRT[TAIL_ID[i],HEAD_ID[i]]<-1
}

#Vertex match (length = 221) applicable to all twitter networks
vertex_match <- match(network.vertex.names(net), network.vertex.names(twitter_tempAll), nomatch=999)

missingNode <- c()
for (i in 1:length(vertex_match)){
  if (vertex_match[i] == 999){
    missingNode <- c(missingNode, i)
  }
}

net_mat <- as.matrix(net)
net_twitter_mat <- net_mat[-c(missingNode),]
net_twitter_mat <- net_twitter_mat[,-c(missingNode)]

set.edge.attribute(x=twitter_tempAll, attrname="surveyLink", value=as.numeric(net_twitter_mat))
set.edge.attribute(x=twitter_tempNoRT, attrname="surveyLink", value=as.numeric(net_twitter_mat))


OrgType_twitter <- get.vertex.attribute(net, "ORGTYPE")
OrgType_twitter <- OrgType_twitter[-c(missingNode)]
set.vertex.attribute(twitter_tempAll, "OrgType", OrgType_twitter)
set.vertex.attribute(twitter_tempNoRT, "OrgType", OrgType_twitter)


# for (i in 1:length(vertex_match)){
#   if (vertex_match[i] == 999){
#     twitter_tempX[i,]<-NA
#     twitter_tempX[,i]<-NA
#   }
# }

twitter_all <- twitter_tempAll
twitter_NoRT <- twitter_tempNoRT
setwd("C:/Users/alhayes/Desktop/salish/analysis")
save(twitter_all, file = "twitter_all.RData")
save(twitter_NoRT, file = "twitter_NoRT.RData")
save(net_twitter_mat, file = "net_twitter_mat.RData")
