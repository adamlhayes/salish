#from twitter csv files, return all twitter user mentioned by an ego

import os.path
import csv
import re

regex = r"(?<=^|(?<=[^a-zA-Z0-9-_\.]))@([A-Za-z_]+[A-Za-z0-9_]+)"


subdirectory = "tweets_json updated node list"
    

with open('twitter updated nodes.txt', 'r') as f:
    seeds = f.readlines()
    

users = []
for oldname in seeds:
    newname = oldname.strip('\n')
    users.append(newname)

output_file = open("updatedTwitter_egocentric.csv", "w", encoding="utf-8")

for screen_name in users:
    with open(os.path.join(subdirectory, '{}s_tweets.csv'.format(screen_name)), 'rt') as f: 
        reader = csv.reader(f, delimiter=',')
        for row in reader:
            if row == []:
                continue
            mentions = re.findall(regex, row[2])
            for mention in mentions:
                print(screen_name + "," + mention + "," + row[1])
                print(screen_name + "," + mention + "," + row[1], file = output_file)
